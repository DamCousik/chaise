<!DOCTYPE html>
<html>
    <head>
        <title>Upload To Hatrac</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
        <script type="text/javascript" src="sparkMD5.min.js"></script>
        <script type="text/javascript" src="hatrac.min.js"></script>
    </head>
    <body>
        <p>
            Select file and press upload<input type="file" id="file">
            <button onclick="upload()">Upload</button>
        </p>
        <!--<p>
            <button onclick="pause()">Pause</button>
            <button onclick="resume()">Resume</button>
            <button onclick="cancel()">Cancel</button>
        </p>-->
        <p>
            <progress id="uploading_progress" value="0" max="100"></progress>
            <- Uploading Progress Bar
            <br>
            <progress id="uploaded_progress" value="0" max="100"></progress>
            <- Uploaded Progress Bar
            <br>
            <progress id="summed_progress" value="0" max="100"></progress>
            <- Uploading + Uploaded Progress Bar
        </p>
        <script src="jquery-1.9.1.min.js"></script>
        <script src="upload.js"></script>
        <script>
                var hatracUpload = null;

                function pause() {
                    hatracUpload.pause();
                }

                function resume() {
                    hatracUpload.resume();
                }

                function cancel() {
                    hatracUpload.cancel();
                    hatracUpload = null;
                }

                function upload(user, pass) {
                    if (!(window.File && window.FileReader && window.FileList && window.Blob && window.Blob.prototype.slice)) {
                        alert("Sorry! You are using an older or unsupported browser. Please update your browser");
                        return;
                    }

                    if (hatracUpload != null) {
                        alert("Though it is possible to upload multiple files at once, this demonstration does not allowed to do so to demonstrate pause and resume in a simple manner. Sorry :-(");
                        return;
                    }

                    var file = $('#file')[0].files[0];
                    hatracUpload = new hatrac.Upload(file, { url: "https://dev.isrd.isi.edu/hatrac/test" });

                    hatracUpload.onServerError = function(command, jqXHR, textStatus, errorThrown) {
                        if (jqXHR.status === 403) {
                            alert("Sorry you are not allowed to upload");
                        } else {
                            console.log("Our server is not responding correctly");
                        }
                    };

                    hatracUpload.onUploadError = function(xhr) {
                       alert(xhr.status + " : "  + xhr.responseText)
                    };

                    hatracUpload.onError = function(err) {
                       alert(err.message);
                    };


                    hatracUpload.onProgressChanged = function(uploadingSize, uploadedSize, totalSize) {
                        $('#uploading_progress').attr('value', uploadingSize);
                        // $('#uploading_progress').attr('max', totalSize);

                        $('#uploaded_progress').attr('value', uploadedSize);
                        // $('#uploaded_progress').attr('max', totalSize);

                        $('#summed_progress').attr('value', uploadedSize + uploadingSize);
                        // $('#summed_progress').attr('max', totalSize);
                    };

                    hatracUpload.onUploadCompleted = function(url) {
                        alert("Congratz, upload is complete now \n" + url);
                    };

                    hatracUpload.start();
                }
        </script>
    </body>
</html>