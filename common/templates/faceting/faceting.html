<div class="faceting-container" du-scroll-container>
    <div class="columns-container">
        <uib-accordion close-others="false">
            <!-- TODO test this last active  -->
            <div uib-accordion-group ng-repeat="fc in vm.reference.facetColumns track by $index" is-open="vm.facetModels[$index].isOpen" id="fc-{{$index}}" class="{{lastActiveFacet == $index ? 'focused': ''}}">
                    <uib-accordion-heading>
                        <h4 class="panel-title accordion-toggle" id="fc-heading-{{$index}}"  ng-click="toggleFacet($index)">
                            <i class="pull-left glyphicon toggle-icon" ng-class="{'glyphicon-chevron-down': vm.facetModels[$index].isOpen, 'glyphicon-chevron-right': !vm.facetModels[$index].isOpen}"></i>
                                
                            <a ng-attr-uib-tooltip="{{::(fc.comment) ? fc.comment : undefined}}" ng-attr-tooltip-placement="{{::(fc.comment) ? 'top' : undefined}}" title="{{fc.comment}}">
                                <span ng-if="::fc.displayname.isHTML" ng-bind-html="::fc.displayname.value"></span>
                                <span ng-if="::!fc.displayname.isHTML" ng-bind="::fc.displayname.value"></span>
                            </a>
                            <img ng-if="vm.facetModels[$index].isLoading" src="../common/styles/images/loader.gif" class="spinner spinner-sm"/>
                        </h4>
                    </uib-accordion-heading>
                <div ng-switch="fc.preferredMode">
                    <range-picker ng-switch-when="range" vm="vm" facet-column="fc" facet-model="vm.facetModels[$index]" index="$index"></range-picker>
                    <choice-picker ng-switch-default facet-column="fc" facet-model="vm.facetModels[$index]" index="$index"></string-picker>
                </div>
            </div>
        </uib-accordion>
    </div>
</div>
