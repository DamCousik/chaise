<!DOCTYPE html>
<html ng-app="chaise.recordEdit">
<head>
    <title>RecordEdit App</title>
    <meta charset="utf-8" http-equiv="X-UA-Compatible" content="IE=10; IE=9; IE=8; IE=7; IE=EDGE" />
    <script src="/gtm-id.js"></script>
    %ASSETS%
    <!--
        IE8 support, see AngularJS Internet Explorer Compatibility http://docs.angularjs.org/guide/ie
        For Firefox 3.6, you will also need to include jQuery and ECMAScript 5 shim
    -->
    <!--[if lt IE 9]>
        <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.js"></script>
        <script src="http://cdnjs.cloudflare.com/ajax/libs/es5-shim/2.2.0/es5-shim.js"></script>
        <script>
            document.createElement('ui-select');
            document.createElement('ui-select-match');
            document.createElement('ui-select-choices');
        </script>
    <![endif]-->
</head>
<body class="chaise-body">
    <div class="container-fluid">
        <navbar></navbar>
        <loading-spinner ng-show="!displayReady && !error"></loading-spinner>
        <div ng-if="reference && (reference.canCreate || reference.canUpdate)">
            <div ng-controller="FormController as form" class="row">
                <div ng-show="!form.resultset">
                    <loading-spinner ng-show="form.submissionButtonDisabled || showSpinner"></loading-spinner>
                    <div class="col-xs-12">
                        <div class="row main-container">
                            <!-- Alerts section -->
                            <div ng-repeat="alert in form.alerts" class="row">
                                <div class="col-xs-12">
                                    <div class="alert alert-dismissible" ng-class="{'alert-danger': alert.type == 'error', 'alert-success': alert.type == 'success', 'alert-warning': alert.type == 'warning'}" role="alert">
                                        <button type="button" class="close" ng-click="::form.closeAlert(alert);" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                                        <strong>{{alert.type | toTitleCase}}</strong> <span ng-bind-html="alert.message"></span>
                                    </div>
                                </div>
                            </div>
                            <!-- Form section -->
                            <div class="col-xs-12">
                                <div class="row">
                                    <div ng-if="displayname" class="col-xs-7">
                                        <div id="entity-title"><span ng-if="::!form.editMode">Create</span><span ng-if="::form.editMode">Edit</span> <span ng-if="::displayname.isHTML" ng-bind-html="::displayname.value"></span><span ng-if="::!displayname.isHTML" ng-bind="::(displayname.value || displayname)"></span> Record<span ng-show="form.recordEditModel.rows.length > 1">s</span></div>
                                        <span class="text-danger">*</span> indicates required field
                                    </div>
                                    <div class="col-xs-5 padding-top-10">
                                        <div class="pull-right">
                                            <button id="submit-record-button" class="btn btn-primary btn-inverted" type="submit" ng-disabled="form.submissionButtonDisabled" ng-click="::form.submit();">Submit Data</button>
                                        </div>
                                    </div>
                                </div>
                                <div class="row padding-right-15" ng-show="::!form.editMode">
                                    <div class="btn-group pull-right">
                                        <button id="copy-record-btn" class="btn btn-primary btn-inverted center-block" ng-click="::form.copyFormRow();" ng-if="::!form.editMode" type="button" ng-disabled="!form.canAddMore" tooltip-placement="bottom" uib-tooltip="Click to add 1 record.">
                                            <span class="glyphicon glyphicon-plus"></span>
                                        </button>
                                        <button id="copy-x-rows-btn" class="btn btn-primary btn-inverted center-block" ng-click="::(form.showMultiInsert = !form.showMultiInsert)" type="button" ng-disabled="!form.canAddMore" tooltip-placement="bottom-right" uib-tooltip="Click to add a maximum of {{::form.MAX_ROWS_TO_ADD-1}} records.">
                                            <span class="glyphicon glyphicon-chevron-down"></span>
                                        </button>
                                    </div>
                                </div>
                                <div class="row padding-right-15"  style="position: absolute; right: 15px;">
                                    <div class="pull-right add-rows-input" ng-class="form.showMultiInsert ? 'chaise-visible' : 'chaise-hidden'">
                                        <div class="input-group">
                                            <input id="copy-rows-input" type="number" class="form-control " ng-model="form.numberRowsToAdd">
                                            <span class="input-group-btn">
                                                <button id="copy-rows-submit" class="btn btn-sm btn-primary btn-inverted center-block" ng-click="::form.copyFormRow()" type="button" tooltip-placement="bottom" uib-tooltip="Submit">
                                                    <span class="glyphicon glyphicon-ok"></span>
                                                </button>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                                <div class="row form-container" style="margin-top: 25px;">
                                    <div ng-show="displayReady" class="col-xs-12" id="formEditScroll" ng-class="{'editMode': form.editMode, 'createMode': !form.editMode}" ng-style="form.formEditDivMarginLeft">
                                        <div ng-style="form.tableWidth"></div>
                                    </div>
                                    <div ng-show="displayReady" class="col-xs-12" id="formEdit" ng-class="{'editMode': form.editMode, 'createMode': !form.editMode}" ng-style="form.formEditDivMarginLeft"><!-- no match -->
                                        <table ng-form="form.formContainer" class="table">
                                            <tr>
                                                <td ng-style="form.firstHeaderStyle">Record Number</td>
                                                <td ng-style="form.headerHeight" class="form-header" ng-repeat="(rowIndex, row) in form.recordEditModel.rows track by $index">
                                                    <div class="row">
                                                        <div class="col-xs-12">
                                                            <div class="pull-left" ng-bind="rowIndex + 1"></div>
                                                            <delete-link ng-if="::!form.editMode" class="pull-right" ng-show="form.recordEditModel.rows.length > 1" button-size="sm"  tooltip-placement="bottom" uib-tooltip="Click to remove this record from the form." icon="true" display="button" callback="::form.removeFormRow(rowIndex);"></delete-link>
                                                        </div>
                                                    </div>
                                                </td>
                                            </tr>
                                            <tr class="entity" ng-form="form.formContainer.row[rowIndex]" ng-repeat="(columnIdx, column) in reference.columns">
                                                <td ng-style="form.captionColumnWidth" class="entity-key col-xs-1">
                                                    <span ng-if="::form.isRequired(column);" class="text-danger">*</span>
                                                    <span class="column-displayname" ng-attr-tooltip-placement="{{::(column.comment) ? 'right' : undefined}}" ng-attr-uib-tooltip="{{::(column.comment) ? column.comment : undefined}}">
                                                        <span ng-if="::column.displayname.isHTML" ng-bind-html="::column.displayname.value"></span>
                                                        <span ng-if="::!column.displayname.isHTML" ng-bind="::column.displayname.value"></span>
                                                    </span>
                                                </td>
                                                <td class="entity-value" ng-form="form.formContainer.row[rowIndex][column.name]" ng-repeat="(rowIndex, row) in form.recordEditModel.rows track by $index" ng-switch="form.columnToDisplayType(column);">
                                                  <recordedit-cols form = "form" column = "column" row-index="rowIndex" row = "row"></recordedit-cols>
                                                  <span ng-switch-when="array">
                                                      <button  class ="btn btn-primary btn-inverted" id="addMoreRecord-{{columnIdx}}" ng-click="::form.copyFormField(columnIdx, column)">
                                                        <span class="glyphicon glyphicon-plus"></span>
                                                      </button>
                                                    <button class ="btn btn-primary btn-inverted" ng-click="::form.removeFormField(columnIdx, column)">
                                                        <span class="glyphicon glyphicon-minus"></span>
                                                    </button>
                                                </td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div ng-show="form.resultset" class="container-fluid">
                    <div class="main-container">
                        <h2 id="result-title">
                            <span>{{ form.resultsetModel.rowValues.length }}/{{ form.resultsetModel.pageLimit }}</span>
                            <a ng-href="{{::form.recordsetLink}}">
                                <span ng-if="::form.resultsetModel.tableDisplayname.isHTML" ng-bind-html="::form.resultsetModel.tableDisplayName.value"></span>
                                <span ng-if="::!form.resultsetModel.tableDisplayname.isHTML" ng-bind="::form.resultsetModel.tableDisplayName.value"></span>
                            </a>
                            <span>Records <span ng-if="::!form.editMode">Created</span><span ng-if="::form.editMode">Updated</span> Successfully</span>
                        </h2>
                        <div class="side-padding-15">
                            <h3>{{ form.resultsetModel.rowValues.length }} Successful <span ng-if="::!form.editMode">Creations</span><span ng-if="::form.editMode">Updates</span></h3>

                            <record-table vm="form.resultsetModel"></record-table>

                            <div ng-if="form.omittedResultsetModel">
                                <h3>{{ form.omittedResultsetModel.rowValues.length }} Failed <span ng-if="::!form.editMode">Creations</span><span ng-if="::form.editMode">Updates</span></h3>

                                <record-table vm="form.omittedResultsetModel" default-row-linking="true"></record-table>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </div>
    <footer></footer>
</body>
</html>
