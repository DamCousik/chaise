<div>
	<div ng-controller="InitListCtrl as facetInit" id="ajaxSpinnerContainer" ng-hide="facetInit.hideSpinner()">
		<img src="images/ajax-loader.gif" id="ajaxSpinnerImage"
			title="Processing..." alt="Spinner" ng-hide="facetInit.hideSpinner()"
			class="center" />
	</div>

	<div ng-controller="DetailListCtrl as facetDetail" class="modal fade" id="viewdata" tabindex="-1" role="dialog"
		aria-labelledby="viewAllData" aria-hidden="true">
		<div class="modal-dialog modal-lg">
			<div class="modal-content">
				<div class="modal-header">
					<button type="button" class="close" data-dismiss="modal" ng-click="facetDetail.closeModal($event);">
						<span aria-hidden="true">&times;</span><span class="sr-only">Close</span>
					</button>
					<h4 class="modal-title" id="viewAllData">{{FacebaseData.entryTitle}}</h4>
				</div>
				<div class="modal-body">
					<div id="datacontent">
						<h1>{{facetDetail.displayTable(FacebaseData.table)}}</h1>
						<table class="dataset">
							<tr ng-repeat="name in FacebaseData.detailColumns">
								<td class="key">{{facetDetail.display(FacebaseData.table,name)}}:</td>
								<td class="value">
									<span ng-if="facetDetail.isThumbnail(FacebaseData.table,name)">
										<a ng-href="{{FacebaseData.entryRow[name]}}">
											<img title="Thumbnail" alt="Undefined" width="90" height="90" ng-src="{{FacebaseData.entryRow[name]}}">
										</a>
									</span>
									<span ng-if="facetDetail.is3dView(FacebaseData.table,name)" ng-init="entry3Dview=facetDetail.init3Dview(FacebaseData.entryRow[name])">
										<iframe title="3dView" width="300" height="300" ng-src="{{entry3Dview}}">
											<p>Your browser does not support iframes.</p>
										</iframe>
										<a ng-href="{{FacebaseData.entryRow[name]}}">
											Enlarge
										</a>
									</span>
									<span ng-if="facetDetail.isZoomify(FacebaseData.table,name)">
										<button type="button" class="btn btn-default" ng-click="facetDetail.openZoomify($event, FacebaseData.entryRow[name])">Open</button>
									</span>
									<span ng-if="facetDetail.isDownload(FacebaseData.table,name)">
										<button type="button" class="btn btn-default" ng-click="facetDetail.download($event, FacebaseData.entryRow[name])">Download</button>
									</span>
									<span ng-if="facetDetail.isHTML(FacebaseData.table,name)" ng-bind-html="facetDetail.html(FacebaseData.table,name,FacebaseData.entryRow[name])">
									</span>
									<span ng-if="facetDetail.isText(FacebaseData.table,name)">
										{{facetDetail.detailValue(FacebaseData.table,name,FacebaseData.entryRow[name])}}
									</span>
								</td>
							</tr>
							<tr ng-repeat="(name, data) in FacebaseData.linearizeView">
								<td class="key">{{facetDetail.display(data['table'],name)}}:</td>
								<td class="value">
									<ul ng-class="facetDetail.setListClass(data['rows'])">
										<li ng-repeat="value in data['rows']">
											<span ng-if="facetDetail.isAttribute(data['table'],name)">{{facetDetail.itemDenormalizedValue(data['table'],value,name,value[name])}}</span>
											<span ng-if="facetDetail.isGeoGDS(data['table'],name)"><a ng-href="{{facetDetail.geoValue(data['table'],value,name)}}">{{value[name]}}</a></span>
											<span ng-if="facetDetail.isGeoGSE(data['table'],name)"><a ng-href="{{facetDetail.geoValue(data['table'],value,name)}}">{{value[name]}}</a></span>
											<span ng-if="facetDetail.isThumbnail(data['table'],name)">
												<a ng-href="{{value[name]}}">
													<img title="Thumbnail" alt="Undefined" width="90" height="90" ng-src="{{value[name]}}">
												</a>
											</span>
											<span ng-init="thumbnail=facetDetail.itemAssociateThumbnail(data['table'],value,name)">
												<span ng-if="thumbnail!=null&&FacebaseData.tiles.length==0">
													<a ng-href="{{thumbnail}}">
														<img title="Thumbnail" alt="Undefined" width="90" height="90" ng-src="{{thumbnail}}">
													</a>
												</span>
											</span>
											<span ng-if="facetDetail.is3dView(data['table'],name)" ng-init="entry3Dview=facetDetail.init3Dview(value[name])">
												<iframe title="3dView" width="300" height="300" ng-src="{{entry3Dview}}">
													<p>Your browser does not support iframes.</p>
												</iframe>
												<a ng-href="{{value[name]}}">
													Enlarge
												</a>
											</span>
											<span ng-init="viewer3d=facetDetail.itemAssociate3dView(data['table'],value,name)">
												<span ng-if="viewer3d!=null&&FacebaseData.viewer3dFile.length==0">
													<span ng-init="entry3Dview=facetDetail.init3Dview(viewer3d)">
														<iframe title="3dView" width="300" height="300" ng-src="{{entry3Dview}}">
															<p>Your browser does not support iframes.</p>
														</iframe>
														<a ng-href="{{viewer3d}}">
															Enlarge
														</a>
													</span>
												</span>
											</span>
											<span ng-if="facetDetail.isZoomify(data['table'],name)">
												<button type="button" class="btn btn-default" ng-click="facetDetail.openZoomify($event, value[name])">Open</button>
											</span>
											<span ng-if="facetDetail.isDownload(data['table'],name)">
												<button type="button" class="btn btn-default" ng-click="facetDetail.download($event, value[name])">Download</button>
											</span>
											<span ng-init="file=facetDetail.itemAssociateFile(data['table'],value,name)">
												<span ng-if="file!=null&&FacebaseData.files.length==0">
													<button type="button" class="btn btn-default" ng-click="facetDetail.download($event, file)">Download</button>
												</span>
											</span>
										</li>
									</ul>
								</td>
							</tr>
						</table>
                        <h3 ng-show="FacebaseData.tiles.length>0">Images:</h3>
                        <table>
                            <tr ng-repeat="values in FacebaseData.tiles">
                                <td ng-repeat="tile in values track by $index" class="tiles">
                                    <a ng-if="tile!=''" ng-href="{{tile}}">
                                            <img title="Thumbnail" alt="" width="90" height="90" ng-src="{{tile}}">
                                    </a>
                                </td>

                             </tr>
                        </table>
                        <h3 ng-show="FacebaseData.files.length>0 || FacebaseData.viewer3dFile.length>0">Files:</h3>
                        <table ng-if="FacebaseData.files.length>0 || FacebaseData.viewer3dFile.length>0" class="files">
                            <tr>
                                <th ng-class="facetDetail.setPreviewClass()">Preview</th>
                                <th class="files">Name</th>
                                <th class="size">Size (bytes)</th>
                            </tr>
                            <tr ng-repeat="values in FacebaseData.viewer3dFile">
                                <td ng-class="facetDetail.setPreviewClass()" ng-init="entry3Dview=facetDetail.init3Dview(values[3])">
                                	<table ng-if="values[5]!= null">
                                		<tr>
                                			<td>
		                                       <iframe title="3dView" width="500" height="400" ng-src="{{entry3Dview}}">
													<p>Your browser does not support iframes.</p>
		                                       </iframe>
                                			</td>
                                		</tr>
                                	</table>
                                	<table ng-if="values[5]!= null">
                                		<tr>
                                			<td class="center">
		                                       <a ng-href="{{values[4]}}" ng-click="facetDetail.enlarge($event, values[4])">
		                                               Enlarge
		                                       </a>
                                			</td>
                                		</tr>
                                	</table>
                                </td>
                                <td class="files">
                                    <a ng-href="{{values[0]}}">
                                            {{values[1]}}
                                    </a>
                                </td>
                                <td class="size">{{values[2] | number}}</td>
                             </tr>
                             <tr ng-repeat="values in FacebaseData.files">
                                <td ng-class="facetDetail.setPreviewClass()">{{values[0]}}</td>
                                <td class="files">
                                    <a ng-href="{{values[2]}}">{{values[1]}}
                                    </a>
                                </td>
                                <td class="size">{{values[3] | number}}</td>
                             </tr>
                        </table>
					</div>
					<div class="modal-footer">
						<button type="button" class="btn btn-default" data-dismiss="modal" ng-click="facetDetail.closeModal($event);">Close</button>
					</div>
				</div>
			</div>
		</div>
	</div>

	<!-- Row 2: Filters / Search results -->
	<div class="row" id="content">
      	<div ng-controller="FilterListCtrl as facetFilter" class="col-lg-3 col-sm-3" ng-click="facetFilter.closeModal($event);">
      		<form role="form" class="form-horizontal" ng-show="facetFilter.showTableSelect()">
      			<div class="form-group">
      				<div class="col-sm-3 col-sm-offset-1">
      					<label class="control-label">Collections:</label>
      				</div>
      				<div class="col-sm-5 col-sm-offset-2">
      					<select class="form-control" ng-model="FacebaseData.table" ng-change="facetFilter.table_select()" ng-options="value for value in tables"></select>
      				</div>
      			</div>
      		</form>
      		
      		<div id="filters" ng-show="facetFilter.showFilters()">
      			<div class="row" ng-show="facetFilter.showTree()">
      				<div class="entity" id="treeDiv">
						<script type="text/ng-template" id="tree_item_renderer.html">
    						<label ng-show="data.expand && data.nodes.length > 0" ng-click="facetFilter.expandCollapse(data, true)">+</label>
							<label ng-show="!data.expand && data.nodes.length > 0" ng-click="facetFilter.expandCollapse(data, false)">-</label>
							<label ng-click="facetFilter.getEntityResults($event, data)">{{data.display}} {{facetFilter.displayTreeCount(data)}}</label>
    						<ul ng-show="data.show" class="entity">
        						<li class="entity" ng-repeat="data in data.nodes" ng-include="'tree_item_renderer.html'"></li>
    						</ul>
  						</script>
						<ul class="entity">
	      					<li class="entity" ng-repeat="data in FacebaseData.tree" ng-include="'tree_item_renderer.html'"></li>
	      				</ul>
      				</div>
      			</div>
      			<div class="row">
  					<div class="col-sm-12">
			      		<form class="form-inline" role="form" ng-show="facetFilter.showSort()">
							<div class="form-group sort-attr" id="attrsort">
								<label for="sort">Sort:</label> <select class="form-control"
									name="field-pick" id="sort" ng-model="FacebaseData.sortFacet"
									ng-change="facetFilter.changeSortOption()"
									ng-options="value for value in sortColumns"></select> <a
									href="#" ng-click="facetFilter.changeSortDirection($event)"><span class="glyphicon glyphicon-sort-by-attributes"></span></a>
							</div>
							<br/>
							<br/>
						</form>
					</div>
				</div>
      			<div class="row" ng-show="facetFilter.showRefine()">
      				<div class="col-sm-5 pull-right">
      					<button class="ng-hide btn btn-default btn-sm pull-right" ng-click="facetFilter.clear($event)" ng-show="facetFilter.showClearButton()" >Reset All</button>
      				</div>
      				<div class="col-sm-7">
      					<p class="filtertitle">Refine by</p>
      				</div>
      			</div>
				<div class="row" ng-show="facetFilter.showRefine()">
					<div class="col-sm-12">
						<div class="panel-group" id="filtermenu">
							<div class="panel panel-default" ng-repeat="facet in FacebaseData.facets"
								ng-show="facetFilter.showFacetCount(facet)"
								ng-click="facetFilter.toggleFacet($event, facet)">
								<div class="panel-heading">
									<h4 class="panel-title">
										<a data-toggle="collapse" href="#" ng-click="facetFilter.preventDefault($event)"><span class="glyphicon glyphicon-plus"></span>{{facet['display']}}</a> <span
											class="pull-right">{{FacebaseData.box[facet['table']][facet['name']]['facetcount']}}</span>
									</h4>
								</div>
								<div class="panel-collapse collapse in">
									<div class="panel-body">
										<ul class="nav filteritems" ng-hide="facetFilter.hide(facet)">
											<li ng-if="facetFilter.if_type(facet, 'bigint')"><rzslider
													rz-slider-model="FacebaseData.box[facet['table']][facet['name']]['min']"
													rz-slider-high="FacebaseData.box[facet['table']][facet['name']]['max']"
													rz-slider-floor="FacebaseData.box[facet['table']][facet['name']]['floor']"
													rz-slider-ceil="FacebaseData.box[facet['table']][facet['name']]['ceil']"
													ng-mouseup="facetFilter.delay_slider(facet)"> </rzslider></li>
											<li ng-if="facetFilter.if_type(facet, 'text')"><input
												type="text" ng-model="FacebaseData.box[facet['table']][facet['name']]['value']"
												ng-keyup="facetFilter.delay_predicate(facet,$event.keyCode)"/></li>
											<li ng-if="facetFilter.if_type(facet, 'enum')"
												ng-repeat="value in FacebaseData.colsDescr[facet['table']][facet['name']]['values']"
												ng-hide="facetFilter.showFacetValue(facet, value)"><input
												type="checkbox" ng-model="FacebaseData.box[facet['table']][facet['name']]['values'][value]"
												ng-change="facetFilter.predicate_checkbox(facet)"
												ng-disabled="facetFilter.showFacetValue(facet, value)" />{{value}}
												<span class="pull-right badge">{{FacebaseData.colsGroup[facet['table']][facet['name']][value]}}</span>
											</li>
										</ul>
									</div>
								</div>
							</div>
							<div class="panel panel-default more">
								<div class="panel-heading">
									<h4 class="panel-title">
										<a data-toggle="collapse" href="#" ng-click="facetFilter.displayMore($event)"> More filter
											options&nbsp;&nbsp;<span
											class="glyphicon glyphicon-collapse-down pull-right"></span>
										</a>
									</h4>
								</div>
								<div class="panel-collapse collapse in">
									<div class="panel-body">
										<ul class="nav filteritems" ng-show="FacebaseData.moreFlag">
											<li ng-repeat="facet in FacebaseData.facets"><input
												type="checkbox"
												ng-model="FacebaseData.chooseColumns[facet['table']][facet['name']]">{{facet['display']}}</li>
										</ul>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>
		
		<!-- Search Results -->
		<div  ng-controller="ResultsListCtrl as facetResults" class="col-lg-9 col-sm-9" ng-show="facetResults.showResults()" ng-click="facetResults.closeModal($event);">
			<div class="row" id="searchsort" ng-show="FacebaseData.pageNavigation">
				<form class="form-inline" role="form">
					<div ng-show="FacebaseData.pageNavigation" ng-bind-html="FacebaseData.collectionsPredicate">
					</div>
					<div ng-show="FacebaseData.pageNavigation" class="col-sm-6 col-md-5 col-lg-4">
						<div class="form-group has-feedback">
							<label class="control-label sr-only">Search Data</label>
							<input id="dataSearch" type="text" ng-model="FacebaseData.filterAllText" class="form-control"
								placeholder="Search data..." size="44" maxlength="120"
								ng-change="facetResults.delay_search_all($event.keyCode)">
						</div>
					</div>
					<div ng-show="FacebaseData.pageNavigation" class="col-sm-4 col-md-3 col-lg-2">
						<div class="form-group">
							<label for="show">Show</label> <select class="form-control"
								name="field-pick" id="show" ng-model="FacebaseData.pagingOptions.pageSize"
								ng-options="value for value in FacebaseData.pagingOptions.pageSizes"></select>
						</div>
					</div>
					<div ng-show="FacebaseData.pageNavigation" class="col-sm-4 col-md-4 col-lg-3">
						<div class="form-group">
							<ul class="pagination toppagination">
								<li class="prev"><a href="#"
									ng-hide="facetResults.cantPageBackward()"
									ng-click="facetResults.pageToFirst($event)">&laquo;</a></li>
								<li class="prev"><a href="#"
									ng-hide="facetResults.cantPageBackward()"
									ng-click="facetResults.pageBackward($event)">&lt;</a></li>
								<li ng-repeat="page in FacebaseData.pageRange" ng-class="facetResults.setActiveClass($index)"><a href="#"
									ng-click="facetResults.selectPage($event, page)" ng-show="facetResults.pageInRange(page)">{{facetResults.pageButton(page)}}<span class="sr-only">(current)</span></a></li>
								<li class="next"><a href="#"
									ng-show="facetResults.canPageForward()"
									ng-click="facetResults.pageForward($event)">&gt;</a></li>
								<li class="next"><a href="#"
									ng-show="facetResults.canPageForward()"
									ng-click="facetResults.pageToLast($event)">&raquo;</a></li>
							</ul>
						</div>
					</div>
				</form>
			</div>
			<div ng-show="FacebaseData.pageNavigation" id="results_tally">
				<p>
					Page {{FacebaseData.pagingOptions.currentPage}} of {{FacebaseData.maxPages}}. Showing results
					<strong>{{(FacebaseData.pagingOptions.currentPage-1)*FacebaseData.pagingOptions.pageSize+1}}-{{facetResults.lastRecord()}}</strong>
					of <strong>{{FacebaseData.totalServerItems}}.</strong>
				</p>
			</div>
			<div id="resultstable">
				<div class="resultsrow" ng-init="FacebaseData.spinner=[]" ng-repeat="row in FacebaseData.ermrestData">
                    <div ng-init="FacebaseData.spinner[$index]=false" class="ng-hide" ng-show="facetResults.showSpinner($index)">
                            <img src="images/ajax-loader.gif"
                                    title="Processing..." alt="Spinner" ng-show="facetResults.showSpinner($index)"
                                    class="center" />
                    </div>
					<div class="row tableheader">
						<div class="col-sm-6">
                                                    <a ng-href="#" data-toggle="modal" data-target="#viewdata" ng-click="facetResults.clicker($event, row, 3, $index);">
							<p class="title" ng-bind-html="facetResults.itemTitle(row)"></p>
                                                    </a>
						</div>
						<div class="col-sm-6">
							<button type="button" class="btn btn-default btn-sm pull-right"
								data-toggle="modal" data-target="#viewdata"
								ng-click="facetResults.clicker($event, row, 3, $index);">View Data</button>
						</div>
					</div>
					<table ng-init="thumbnail=facetResults.itemThumbnail(row)">
						<tr>
							<td ng-show="thumbnail!=null">
								<a ng-href="#" data-toggle="modal" data-target="#viewdata" ng-click="facetResults.clicker($event, row, 3, $index);">
									<img title="Thumbnail" alt="Undefined" width="90" height="90" ng-src="{{thumbnail}}">
								</a>
							</td>
							<td ng-show="facetResults.if_hasThumbnail() && thumbnail==null">
								<a ng-href="#" data-toggle="modal" data-target="#viewdata" ng-click="facetResults.clicker($event, row, 3, $index);">
									<img title="Thumbnail" alt="Undefined" width="90" height="90" ng-src="images/blank.jpeg">
								</a>
							</td>
							<td class="item_display">
								<table class="resultsdata table table-condensed"
									ng-init="values=facetResults.displayColumns(row, 3, 3)">
									<tr ng-repeat="value in values">
										<td ng-repeat="col in value track by $index" ng-class="facetResults.setSummaryClass(FacebaseData.table,col,'value')">
											<span ng-show="facetResults.display(FacebaseData.table,col)!=null && !facetResults.isSummary(FacebaseData.table,col)" ng-class="$parent.$first && $first ? 'key truncate' : 'key truncate'">{{facetResults.display(FacebaseData.table,col)}}: </span>
                                                                                        <span ng-switch="facetResults.isSummary(FacebaseData.table,col)">
                                                                                            <span ng-switch-when="true"><p ng-class="facetResults.setSummaryClass(FacebaseData.table,col,'')">{{facetResults.html(FacebaseData.table,col,row[col])}}</p></span>
                                                                                            <span ng-switch-default>{{facetResults.html(FacebaseData.table,col,row[col])}}</span>
                                                                                        </span>
                                                                                        
										</td>
									</tr>
								</table>
							</td>
						</tr>
					</table>
				</div>
			</div>
			<div class="row bottompgr">
				<div class="form-group">
					<ul class="pagination bottompagination">
						<li ng-show="FacebaseData.pageNavigation" class="prev"><a href="#"
							ng-hide="facetResults.cantPageBackward()"
							ng-click="facetResults.pageToFirst($event)">&laquo;</a></li>
						<li ng-show="FacebaseData.pageNavigation" class="prev"><a href="#"
							ng-hide="facetResults.cantPageBackward()"
							ng-click="facetResults.pageBackward($event)">&lt;</a></li>
						<li ng-show="FacebaseData.pageNavigation" ng-repeat="page in FacebaseData.pageRange" ng-class="facetResults.setActiveClass($index)"><a href="#"
							ng-click="facetResults.selectPage($event, page)" ng-show="facetResults.pageInRange(page)">{{facetResults.pageButton(page)}}<span class="sr-only">(current)</span></a></li>
						<li class="next"><a href="#"
							ng-show="facetResults.canPageForward()"
							ng-click="facetResults.pageForward($event)">More...</a></li>
						<li ng-show="FacebaseData.pageNavigation" class="next"><a href="#"
							ng-show="facetResults.canPageForward()"
							ng-click="facetResults.pageToLast($event)">&raquo;</a></li>
					</ul>
				</div>
			</div>
		</div>
	</div>
</div>
		

